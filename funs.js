module.exports = function() {
    this.info=function(){
        var arr=[
            '100007330238343',
            '01692486578',
            'vuxuyen123',
            'vuxuyen',
            'vuxuyen1985',
            'xuyen1985',
            '17101985(da thay doi 2 thang truoc)',
            '19851017',
            '01692486578',
            'xuyen17101985',
            'vuxuyen17101985',
            ''
        ];
        var nguyen_van_anh=[
            '0946832755',
            '02061979',
            '020679',
            '261979',
            'nguyenvananh',
            'nguyenthivananh',
            'vananh1979',
            'anh1979',
            'vananh79',
            'anh123',
            'anh1234',
            'anh12345',
            'nguyenthivananh1979',
            'nguyenthivananh79',
            'anhntv',
            'anhntv1979',
            'hanwhalife',
            'vananhanwhalife',
            ''
        ]
        var kieu_anh=[
            '01674540371',
            'anh1993',
            'kieuanh1993',
            '01674540371'
        ];
        var hong_van=[
            '01673274586',
            '01673274586',
            'nguyenhongvan',
            'nguyenthihongvan',
            'nguyenhongvan89',
            'nguyenhongvan1989',
            'nguyenhongvan15071989',
            'hongvan',
            'hongvan1989',
            '15071989',
            '150789(da dat lai)',
            'hong1989',
            'van1989(da dat lai)',
            'van150789',
            'van15071989',
            'van12345',
            'van89',
            'vannh',
            'cunyeu',
            'van1989123',
            'vannguyen',
            'nguyenvan',
            'vanyeuanh',
            ''
        ]
        var le_loan=[
        '096 746 60 89',
            '0967466089',
            '28091980',
            '280980',
            'loan1980',
            'leloan',
            'lethiloan',
            'leloan80',
            'leloan1980',
            'loan123',
            ''
        ]
        var chien=[
        'lechien1989ctv@gmail.com|01666 959 707'
        ]
        var nga=[
            '0122 527 2821',
            '19111997',
            'nga1997',
            '9693',
            'daonga9693',
            'daonga1997',
            'daonga1996',
            'daonga97',
            'daothinga',
            'daothinga1997',
            '0122 527 2821'
        ]
        var tram=[
            '0968581339',
            ''
        ]
        var dangminhhuyen=[
            '0167 479 5320',
            '01674795320',
            'dangminhhuyen',
            '18101992',
            '181092',
            'huyen92',
            'huyen1992',
            'huyen123',
            'minhhuyen',
            'minhhuyen92',
            'minhhuyen1992',
            '01674795320'
        ]
        var bich_hanh=[
        '0906201185',
        'hanh1985(da doi)',
        'bichhanh1985',
        'hanh20111985',
        'hanh201185(da doi)',
        '201185',
        '31082013',
        '310813',
        ''
        ];
        var arr2=[
        'Miloquangduc0904@gmail.com',
        'dinhthuy2588@gmail.com',
        'Anhchau195@gmail.com',
        'thaonguyengio230@gmail.com',
        'ponbabie2017@gmail.com',
        'thanhthanhtam6@Gmail.com',
        'Xuxudenday@gmail.com',
        'Hacandy93bn@gmail.com',
        'Daothile561990@gmail.com',
        'thanhhoa31101991@gmail.com',
        'maithinh198@gmail.com',
        'phuongthao200589@gmail.com',
        'lovetofindss@gmail.com',
        'betimeo93@gmail.com',
            'trinhlinh231093@gmail.com',
            'Thuyhuynb84@gmail.com',
            'Kembong1988@gmail.com',
            'meongvang@icloud.com',
            'ngapham.ae@gmail.com',
            'thuyhangevent@gmail.com',
            'dinhthuy2588@gmail.com',
            '0912143269',
            '+966 50 734 8196',
            ''
        ]
        var thuong=[
        '094 482 94 48',
        '0944829448',
        '01674106934',
        'thuong1993',
        'thuong93',
        '150293',
        '15021993',
        'xuanyeuthuong',
        'thuongyeuxuan',
        'baoxamnammi',
        'phungthuong',
        'phungthuong1993',
        'gacoi1993',
        'phungthithuong93',
        'phungthithuong1',
        'phungthithuong123',
        'phungthithuong@',
        'phungthithuong$',
        'phung.thuong',
        'thuonglove'
        ];
        var mabu_=['0963988006',
            '0963988006',
            'ha1990',
            'hacoi',
            'hanoi1990',
            'mabu',
            'hacoi90',
            '',
            ''];
        var mabu=['https://www.facebook.com/hacoi1990/about?lst=100004501712555%3A100006672661794%3A1500606398',
            'https://www.facebook.com/thuy.cao.900/about?lst=100004501712555%3A100001200631107%3A1500607449',
            'https://www.facebook.com/quangloi.truong.3?pnref=about.family',
            'https://www.facebook.com/groups/1791957551084900/',
            'https://www.facebook.com/groups/1915358728703508/',
            'https://www.facebook.com/groups/1045553948909577/permalink/1059309710867334/?comment_id=1064294490368856&notif_t=group_comment_reply&notif_id=1501671371772120',
            'https://www.facebook.com/groups/136142006961383/?multi_permalinks=155698405005743&notif_t=group_highlights&notif_id=1501677403974774',
            'https://www.facebook.com/groups/1791957551084900/',
            'skype:live:kieuxinh.1991?chat'
        ]
        var nhomts=[
        '01659927106(trang)',
            '0964387345(lethihanh)',
            '01659101654(vo thao nhien)',
            '0984846056(hien)',
            ''
        ]
        var phuonganh=[
            '0983456186',
            'phamphuonganh',
            'vuhavi',
            'vuhavi123',
            'khainvit',
            'khainv123$',
            'phuonganh',
            'phamphuonganh123',
            'catdatphuonganh',
            'catdatphuonganh2',
            'caidatphuonganh',
            'caidatphuonganh2',
            'caidat2',
            'caidatanh',
            'caidatanh2',
            'skypeit@$',
            'truongquynhanh',
            'phuonganh2',
            '20170415',
            'anh20170415',
            '31081985',
            'anhphuonganh',
            'anhphuonganh2',
            'chemgio123',
            'chemgio',
            'phuonganh1985',
            ''
        ];
        var duc=[
            'nguyenxuanduc301290@gmail.com',
            '0966399832',
            '30121990',
            '301290',
            'xuanduc',
            'xuanduc123',
            'duc1990@',
            'duc301290',
            'xuanduc@321',
            '--------',
            'tplinkF1@gmail.co',
            'tplinkF1@90',
            'tenda@123',
            'X.duc90@gmail.com',
        ]
        var chung=[
            '841237541664',
            'chunghoa1',
            'zalo-0972693114-chunghoa0511'
        ]
    }
    this.unicode = function(str) {
        var slug;
        slug = str.toLowerCase();
        slug = slug.replace(/á|à|ả|ạ|ã|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ/gi, 'a');
        slug = slug.replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ/gi, 'e');
        slug = slug.replace(/i|í|ì|ỉ|ĩ|ị/gi, 'i');
        slug = slug.replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ/gi, 'o');
        slug = slug.replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự/gi, 'u');
        slug = slug.replace(/ý|ỳ|ỷ|ỹ|ỵ/gi, 'y');
        slug = slug.replace(/đ/gi, 'd');
        //xu ly dau
        slug=slug.replace(/()/gi,'');
        slug=slug.replace(/(̃)/gi,'');
        slug=slug.replace(/(́)/gi,'');
        slug=slug.replace(/(̉)/gi,'');
        slug=slug.replace(/(̣)/gi,'');
        //Xoa cac ky tu dac biet
        slug = slug.replace(/\`|\~|\!|\@|\#|\||\$|\%|\^|\&|\*|\(|\)|\+|\=|\,|\.|\/|\?|\>|\<|\'|\"|\:|\;|_/gi, '');
        //doi khoang trang thanh ky tu ngang
        slug = slug.replace(/ /gi, "-");
        //doi nhieu ky tu ngang lien tiep thanh mot ky tu ngang
        slug = slug.replace(/\-\-\-\-\-/gi, '-');
        slug = slug.replace(/\-\-\-\-/gi, '-');
        slug = slug.replace(/\-\-\-/gi, '-');
        slug = slug.replace(/\-\-/gi, '-');
        //xoa cac ky tu ngang o dau va cuoi
        //slug = '@' + slug + '@';
        //slug = slug.replace(/\@\-|\-\@|\@/gi, '');
        return slug;
    };
    this.ConvertObjToStr=function(obj){
        if(typeof str=='object'){
            var str=JSON.stringify(str);
        }else{
            var str=obj;
        }
        return str;
    }
    this.echo_log=function(str){
        if(typeof str=='object'){
            str=JSON.stringify(str);
        }
        var strtime=this.get_time();
        str=strtime+' | '+str;
        console.log(str);
    }
    this.get_time=function(format){
        var d = new Date();
        var y = d.getFullYear();
        var m = d.getMonth()+1;
        if(m < 10){m = '0'+m;}
        var day = d.getDate();
        if(day <10 ){day = '0'+day;}
        var hours = d.getHours();
        var minutes = d.getMinutes();
        var seconds = d.getSeconds();
        var miliseconds = d.getMilliseconds();
        var strtime=y+'-'+m+'-'+day+' '+hours+':'+minutes+':'+seconds+':'+miliseconds;
        if(format==6){
            strtime=y+'-'+m+'-'+day+' '+hours+':'+minutes+':'+seconds;
        }
        if(format==3){
            strtime=y+'-'+m+'-'+day;
        }
        if(format==2){
            strtime=y+'-'+m;
        }
        return strtime;
    }
    this.write_log=function(str){
        var fs=require('fs');
        if(typeof str=='object'){
            str=JSON.stringify(str);
        }
        str=this.get_time()+' | '+str+ '\r\n';
        var file_name='./logs/'+this.get_time(2)+'_log.txt';
        if (fs.existsSync(file_name)) {
            fs.appendFile(file_name, str, function (err) {
                if (err) return console.log(err);
            });
        }else{
            fs.writeFileSync(file_name,str,);
        }
    }
    this.path_upload_today=function(domain){
        var d = new Date();
        var y = d.getFullYear();
        var m = d.getMonth()+1;
        var fs=require('fs');
        var path='/public/uploads/';
        if(domain!=''){
            var path_domain=__dirname+path+domain+'/';
            var path_y=path_domain+y;
            var path_m=path_y+'/'+m;
            var path_rs='/uploads/'+domain+'/'+y+'/'+m;
            if (!fs.existsSync(path_m)){
                if(!fs.existsSync(path_y)){
                    if(!fs.existsSync(path_domain)){
                        fs.mkdirSync(path_domain, 0755);
                    }
                    fs.mkdirSync(path_y);
                }
                fs.mkdirSync(path_m, 0755);
            }
        }else{
            var path_y=__dirname+path+y;
            var path_m=path_y+'/'+m;
            var path_rs='/uploads/'+y+'/'+m;
            if (!fs.existsSync(path_m)){
                if(!fs.existsSync(path_y)){
                    fs.mkdirSync(path_y);
                }
                fs.mkdirSync(path_m, 0755);
            }
        }
        return {path_full:path_m,path:path_rs};
    };
    this.rewrite_filename=function(filename,name_rewrite){
        var pos=filename.lastIndexOf('.');
        var str_length=filename.length;
        var ext=filename.substr(pos+1,str_length-(pos+1));
        if (name_rewrite === undefined) {
            var str_txt=filename.substr(0,pos);
        }else{
            str_txt=name_rewrite;
        }
        str_txt=this.unicode(str_txt);
        var rs=str_txt+'.'+ext;
        return rs;
    }
    this.allow_type_all=function(){
        var type=['jpg','jpeg','gif','png','doc','txt','zip','rar'];
        return type;
    }
    this.allow_type_image=function(){
        var type=["jpg", "jpeg","gif","png"];
        return type;
    }
    this.allow_zise_img=()=>{
        return 1024*10;
    };
    this.getExt=function(file_name,symbol){
        if(symbol){}else{symbol='.'}
        var arr_str=file_name.split(symbol);
        var ext=arr_str.pop();
        return ext.toLowerCase();
	}
	this.upload_file=function(file_name){
		var multer=require('multer');
		var storage=multer.diskStorage({
			destination :function (req,file,cb) {
				cb(null, './uploads');
			},
			filename:function (req,file,cb) {
				cb(null, file.originalname);
			}
		});
		var upload  =multer({storage:storage,fileFilter:this.getExt});
		upload.single(file_name);
	};
    this.paginate=function(link, total_records, current_page, limit){
        if (limit === 'undefined') {
            limit = 10;
        }
        if (current_page === 'undefined' || current_page==0) {
            current_page = 1;
        }
        if (link === 'undefined') {
            link = document.URL;
        }
        if (total_records === 'undefined') {
            total_records = 0;
        }
        // tong so trang
        total_page = Math.ceil(total_records / limit);
        // Giới hạn current_page trong khoảng 1 đến total_page
        if (current_page > total_page){
            current_page = total_page;
        }
        else if (current_page < 1){
            current_page = 1;
        }
        // Tìm Start
        var start = (current_page - 1) * limit;
        $html = '';
        // nếu current_page > 1 và total_page > 1 mới hiển thị nút prev
        if (current_page > 1 && total_page > 1){
            $html += '<a href="'.str_replace('{page}', current_page-1, link)+'">Prev</a>';
        }

        // Lặp khoảng giữa
        for (var i = 1; i <= total_page; i++){
            // Nếu là trang hiện tại thì hiển thị thẻ span
            // ngược lại hiển thị thẻ a
            if (i == current_page){
                $html += '<span>'+i+'</span>';
            }
            else{
                $html += '<a href="'.str_replace('{page}', i, link)+'">'+i+'</a>';
            }
        }
        // nếu current_page < $total_page và total_page > 1 mới hiển thị nút prev
        if (current_page < total_page && total_page > 1){
            $html += '<a href="'.str_replace('{page}', current_page+1, link)+'">Next</a>';
        }
        // Trả kết quả
        return {'start':start,'limit' : limit,'html' : html};
    }
    this.escapeHtml=function (unsafe) {
        if (typeof unsafe == 'undefined'){
            unsafe='';
        }else{
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    }
    this.RemoveObjectInArray=function(arr,val,key){
        if (arr instanceof Array){
            if(arr[0] instanceof  Object){
                var newarr=arr.filter(function(el){
                    return el[key] !=val;
                })
                return newarr;
            }else{
                var _index = arr.indexOf(val);
                if(_index > -1){
                    var a=arr.splice(_index, 1);
                    return arr;
                }
                return arr;
            }
        }else{
            console.log('RemoveObjectInArray | khong la mang');
            return '';
        }
    }
    this.ReNameRoom=function(name,fix){
        if(fix==null){
            return name;
        }else{
            return fix+'_'+name;
        }
    }
    this.GetIp=function(req){
        var ip = req.headers['x-forwarded-for'] ||
            req.connection.remoteAddress ||
            req.socket.remoteAddress ||
            req.connection.socket.remoteAddress;
        ip = ip.split(',')[0];
        ip = ip.split(':').slice(-1);
        return ip[0];
    }
    this.Base64Encode=function (str) {
        return new Buffer(str).toString('base64');
    }
}
